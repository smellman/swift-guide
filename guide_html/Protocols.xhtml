<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
  	<link href="epub.css" media="all" rel="stylesheet" type="text/css" />
  	<script type="text/javascript" src="svg.js"></script>
  </head>
  <body id="conceptual_flow_with_tasks">
    <div class="content-wrapper">
      <div id="chapter_container" class='conceptualwithtasks'>
  <article class="chapter">
    <a id="TP40014097-CH25">&#x200c;</a><a id="TP40014097-CH25-XID_345">&#x200c;</a>
    <h2 class="chapter-name">Protocols</h2>
      
      	<section class="section">
      		<p class="para">A <em>protocol</em> defines a blueprint of methods, properties, and other requirements that suit a particular task or piece of functionality. The protocol doesn’t actually provide an implementation for any of these requirements—it only describes what an implementation will look like. The protocol can then be <em>adopted</em> by a class, structure, or enumeration to provide an actual implementation of those requirements. Any type that satisfies the requirements of a protocol is said to <em>conform</em> to that protocol.</p><p class="para">Protocols can require that conforming types have specific instance properties, instance methods, type methods, operators, and subscripts.</p>
    		</section> 


      <section class="section">
	<a id="TP40014097-CH25-XID_346">&#x200c;</a>
  <h3 class="section-name">Protocol Syntax</h3>
  <p class="para">You define protocols in a very similar way to classes, structures, and enumerations:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">SomeProtocol</code> {</code></li>
          <li><code class="code-voice">    <code class="c">// protocol definition goes here</code></code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">Custom types state that they adopt a particular protocol by placing the protocol’s name after the type’s name, separated by a colon, as part of their definition. Multiple protocols can be listed, and are separated by commas:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">struct</code> <code class="vc">SomeStructure</code>: <code class="n"><!-- a href="" logicalPath="" -->FirstProtocol<!-- /a --></code>, <code class="n"><!-- a href="" logicalPath="" -->AnotherProtocol<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="c">// structure definition goes here</code></code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">If a class has a superclass, list the superclass name before any protocols it adopts, followed by a comma:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">class</code> <code class="vc">SomeClass</code>: <code class="n"><!-- a href="" logicalPath="" -->SomeSuperclass<!-- /a --></code>, <code class="n"><!-- a href="" logicalPath="" -->FirstProtocol<!-- /a --></code>, <code class="n"><!-- a href="" logicalPath="" -->AnotherProtocol<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="c">// class definition goes here</code></code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section>
  
</section>
<section class="section">
	<a id="TP40014097-CH25-XID_347">&#x200c;</a>
  <h3 class="section-name">Property Requirements</h3>
  <p class="para">A protocol can require any conforming type to provide an instance property or type property with a particular name and type. The protocol doesn’t specify whether the property should be a stored property or a computed property—it only specifies the required property name and type. The protocol also specifies whether each property must be gettable or gettable <em>and</em> settable.</p><p class="para">If a protocol requires a property to be gettable and settable, that property requirement cannot be fulfilled by a constant stored property or a read-only computed property. If the protocol only requires a property to be gettable, the requirement can be satisfied by any kind of property, and it is valid for it also to be settable if this is useful for your own code.</p><p class="para">Property requirements are always declared as variable properties, prefixed with the <code class="code-voice">var</code> keyword. Gettable and settable properties are indicated by writing <code class="code-voice">{ get set }</code> after their type declaration, and gettable properties are indicated by writing <code class="code-voice">{ get }</code>.</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">SomeProtocol</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">mustBeSettable</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code> { <code class="kt">get</code> <code class="kt">set</code> }</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">doesNotNeedToBeSettable</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code> { <code class="kt">get</code> }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">Always prefix type property requirements with the <code class="code-voice">class</code> keyword when you define them in a protocol. This is true even though type property requirements are prefixed with the <code class="code-voice">static</code> keyword when implemented by a structure or enumeration:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">AnotherProtocol</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">class</code> <code class="kt">var</code> <code class="vc">someTypeProperty</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code> { <code class="kt">get</code> <code class="kt">set</code> }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">Here’s an example of a protocol with a single instance property requirement:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">FullyNamed</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">fullName</code>: <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code> { <code class="kt">get</code> }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">The <code class="code-voice">FullyNamed</code> protocol defines any kind of thing that has a fully-qualified name. It doesn’t specify what <em>kind</em> of thing it must be—it only specifies that the thing must be able to provide a full name for itself. It specifies this requirement by stating that any <code class="code-voice">FullyNamed</code> type must have a gettable instance property called <code class="code-voice">fullName</code>, which is of type <code class="code-voice">String</code>.</p><p class="para">Here’s an example of a simple structure that adopts and conforms to the <code class="code-voice">FullyNamed</code> protocol:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">struct</code> <code class="vc">Person</code>: <code class="n"><!-- a href="" logicalPath="" -->FullyNamed<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">fullName</code>: <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code></code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="kt">let</code> <code class="vc">john</code> = <code class="vc">Person</code>(<code class="vc">fullName</code>: <code class="s">&quot;John Appleseed&quot;</code>)</code></li>
          <li><code class="code-voice"><code class="c">// john.fullName is &quot;John Appleseed&quot;</code></code></li>
      </ul>



  </div>
</section><p class="para">This example defines a structure called <code class="code-voice">Person</code>, which represents a specific named person. It states that it adopts the <code class="code-voice">FullyNamed</code> protocol as part of the first line of its definition.</p><p class="para">Each instance of <code class="code-voice">Person</code> has a single stored property called <code class="code-voice">fullName</code>, which is of type <code class="code-voice">String</code>. This matches the single requirement of the <code class="code-voice">FullyNamed</code> protocol, and means that <code class="code-voice">Person</code> has correctly conformed to the protocol. (Swift reports an error at compile-time if a protocol requirement is not fulfilled.)</p><p class="para">Here’s a more complex class, which also adopts and conforms to the <code class="code-voice">FullyNamed</code> protocol:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">class</code> <code class="vc">Starship</code>: <code class="n"><!-- a href="" logicalPath="" -->FullyNamed<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">prefix</code>: <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code>?</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">name</code>: <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code></code></li>
          <li><code class="code-voice">    <code class="kt">init</code>(<code class="vc">name</code>: <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code>, <code class="vc">prefix</code>: <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code>? = <code class="vc">nil</code>) {</code></li>
          <li><code class="code-voice">        <code class="kt">self</code>.<code class="vc">name</code> = <code class="vc">name</code></code></li>
          <li><code class="code-voice">        <code class="kt">self</code>.<code class="vc">prefix</code> = <code class="vc">prefix</code></code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">fullName</code>: <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">return</code> (<code class="vc">prefix</code> ? <code class="vc">prefix</code>! + <code class="s">&quot; &quot;</code> : <code class="s">&quot;&quot;</code>) + <code class="vc">name</code></code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="kt">var</code> <code class="vc">ncc1701</code> = <code class="vc">Starship</code>(<code class="vc">name</code>: <code class="s">&quot;Enterprise&quot;</code>, <code class="vc">prefix</code>: <code class="s">&quot;USS&quot;</code>)</code></li>
          <li><code class="code-voice"><code class="c">// ncc1701.fullName is &quot;USS Enterprise&quot;</code></code></li>
      </ul>



  </div>
</section><p class="para">This class implements the <code class="code-voice">fullName</code> property requirement as a computed read-only property for a starship. Each <code class="code-voice">Starship</code> class instance stores a mandatory <code class="code-voice">name</code> and an optional <code class="code-voice">prefix</code>. The <code class="code-voice">fullName</code> property uses the <code class="code-voice">prefix</code> value if it exists, and prepends it to the beginning of <code class="code-voice">name</code> to create a full name for the starship.</p>
  
</section>
<section class="section">
	<a id="TP40014097-CH25-XID_348">&#x200c;</a>
  <h3 class="section-name">Method Requirements</h3>
  <p class="para">Protocols can require specific instance methods and type methods to be implemented by conforming types. These methods are written as part of the protocol’s definition in exactly the same way as for normal instance and type methods, but without curly braces or a method body. Variadic parameters are allowed, subject to the same rules as for normal methods.</p><div class="note">
  <aside class="aside">
    	<p class="aside-title uppercase">Note</p>
    	<p class="para">Protocols use the same syntax as normal methods, but are not allowed to specify default values for method parameters.
    	</p>
    
  </aside>
</div><p class="para">As with type property requirements, you always prefix type method requirements with the <code class="code-voice">class</code> keyword when they are defined in a protocol. This is true even though type method requirements are prefixed with the <code class="code-voice">static</code> keyword when implemented by a structure or enumeration:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">SomeProtocol</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">class</code> <code class="kt">func</code> <code class="vc">someTypeMethod</code>()</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">The following example defines a protocol with a single instance method requirement:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">RandomNumberGenerator</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">random</code>() -&gt; <code class="n"><!-- a href="" logicalPath="" -->Double<!-- /a --></code></code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">This protocol, <code class="code-voice">RandomNumberGenerator</code>, requires any conforming type to have an instance method called <code class="code-voice">random</code>, which returns a <code class="code-voice">Double</code> value whenever it is called. (Although it is not specified as part of the protocol, it is assumed that this value will be a number between <code class="code-voice">0.0</code> and <code class="code-voice">1.0</code> inclusive.)</p><p class="para">The <code class="code-voice">RandomNumberGenerator</code> protocol does not make any assumptions about how each random number will be generated—it simply requires the generator to provide a standard way to generate a new random number.</p><p class="para">Here’s an implementation of a class that adopts and conforms to the <code class="code-voice">RandomNumberGenerator</code> protocol. This class implements a pseudorandom number generator algorithm known as a <em>linear congruential generator</em>:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">class</code> <code class="vc">LinearCongruentialGenerator</code>: <code class="n"><!-- a href="" logicalPath="" -->RandomNumberGenerator<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">lastRandom</code> = <code class="m">42.0</code></code></li>
          <li><code class="code-voice">    <code class="kt">let</code> <code class="vc">m</code> = <code class="m">139968.0</code></code></li>
          <li><code class="code-voice">    <code class="kt">let</code> <code class="vc">a</code> = <code class="m">3877.0</code></code></li>
          <li><code class="code-voice">    <code class="kt">let</code> <code class="vc">c</code> = <code class="m">29573.0</code></code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">random</code>() -&gt; <code class="n"><!-- a href="" logicalPath="" -->Double<!-- /a --></code> {</code></li>
          <li><code class="code-voice">        <code class="vc">lastRandom</code> = ((<code class="vc">lastRandom</code> * <code class="vc">a</code> + <code class="vc">c</code>) % <code class="vc">m</code>)</code></li>
          <li><code class="code-voice">        <code class="kt">return</code> <code class="vc">lastRandom</code> / <code class="vc">m</code></code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="kt">let</code> <code class="vc">generator</code> = <code class="vc">LinearCongruentialGenerator</code>()</code></li>
          <li><code class="code-voice"><code class="vc">println</code>(<code class="s">&quot;Here's a random number: </code>\(<code class="vc">generator</code>.<code class="vc">random</code>())<code class="s">&quot;</code>)</code></li>
          <li><code class="code-voice"><code class="c">// prints &quot;Here's a random number: 0.37464991998171&quot;</code></code></li>
          <li><code class="code-voice"><code class="vc">println</code>(<code class="s">&quot;And another one: </code>\(<code class="vc">generator</code>.<code class="vc">random</code>())<code class="s">&quot;</code>)</code></li>
          <li><code class="code-voice"><code class="c">// prints &quot;And another one: 0.729023776863283&quot;</code></code></li>
      </ul>



  </div>
</section>
  
</section>
<section class="section">
	<a id="TP40014097-CH25-XID_350">&#x200c;</a>
  <h3 class="section-name">Mutating Method Requirements</h3>
  <p class="para">It is sometimes necessary for a method to modify (or <em>mutate</em>) the instance it belongs to. For instance methods on value types (that is, structures and enumerations) you place the <code class="code-voice">mutating</code> keyword before a method’s <code class="code-voice">func</code> keyword to indicate that the method is allowed to modify the instance it belongs to and/or any properties of that instance. This process is described in <a href="Methods.xhtml#TP40014097-CH15-XID_305" data-id="//apple_ref/doc/uid/TP40014097-CH15-XID_305" rel="me">Modifying Value Types from Within Instance Methods</a>.</p><p class="para">If you define a protocol instance method requirement that is intended to mutate instances of any type that adopts the protocol, mark the method with the <code class="code-voice">mutating</code> keyword as part of the protocol’s definition. This enables structures and enumerations to adopt the protocol and satisfy that method requirement.</p><div class="note">
  <aside class="aside">
    	<p class="aside-title uppercase">Note</p>
    	<p class="para">If you mark a protocol instance method requirement as <code class="code-voice">mutating</code>, you do not need to write the <code class="code-voice">mutating</code> keyword when writing an implementation of that method for a class. The <code class="code-voice">mutating</code> keyword is only used by structures and enumerations.
    	</p>
    
  </aside>
</div><p class="para">The example below defines a protocol called <code class="code-voice">Togglable</code>, which defines a single instance method requirement called <code class="code-voice">toggle</code>. As its name suggests, the <code class="code-voice">toggle</code> method is intended to toggle or invert the state of any conforming type, typically by modifying a property of that type.</p><p class="para">The <code class="code-voice">toggle</code> method is marked with the <code class="code-voice">mutating</code> keyword as part of the <code class="code-voice">Togglable</code> protocol definition, to indicate that the method is expected to mutate the state of a conforming instance when it is called:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">Togglable</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">mutating</code> <code class="kt">func</code> <code class="vc">toggle</code>()</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">If you implement the <code class="code-voice">Togglable</code> protocol for a structure or enumeration, that structure or enumeration can conform to the protocol by providing an implementation of the <code class="code-voice">toggle</code> method that is also marked as <code class="code-voice">mutating</code>.</p><p class="para">The example below defines an enumeration called <code class="code-voice">OnOffSwitch</code>. This enumeration toggles between two states, indicated by the enumeration cases <code class="code-voice">On</code> and <code class="code-voice">Off</code>. The enumeration’s <code class="code-voice">toggle</code> implementation is marked as <code class="code-voice">mutating</code>, to match the <code class="code-voice">Togglable</code> protocol’s requirements:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">enum</code> <code class="vc">OnOffSwitch</code>: <code class="n"><!-- a href="" logicalPath="" -->Togglable<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">case</code> <code class="vc">Off</code>, <code class="vc">On</code></code></li>
          <li><code class="code-voice">    <code class="kt">mutating</code> <code class="kt">func</code> <code class="vc">toggle</code>() {</code></li>
          <li><code class="code-voice">        <code class="kt">switch</code> <code class="kt">self</code> {</code></li>
          <li><code class="code-voice">        <code class="kt">case</code> <code class="vc">Off</code>:</code></li>
          <li><code class="code-voice">            <code class="kt">self</code> = <code class="vc">On</code></code></li>
          <li><code class="code-voice">        <code class="kt">case</code> <code class="vc">On</code>:</code></li>
          <li><code class="code-voice">            <code class="kt">self</code> = <code class="vc">Off</code></code></li>
          <li><code class="code-voice">        }</code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="kt">var</code> <code class="vc">lightSwitch</code> = <code class="vc">OnOffSwitch</code>.<code class="vc">Off</code></code></li>
          <li><code class="code-voice"><code class="vc">lightSwitch</code>.<code class="vc">toggle</code>()</code></li>
          <li><code class="code-voice"><code class="c">// lightSwitch is now equal to .On</code></code></li>
      </ul>



  </div>
</section>
  
</section>
<section class="section">
	<a id="TP40014097-CH25-XID_352">&#x200c;</a>
  <h3 class="section-name">Protocols as Types</h3>
  <p class="para">Protocols do not actually implement any functionality themselves. Nonetheless, any protocol you create will become a fully-fledged type for use in your code.</p><p class="para">Because it is a type, you can use a protocol in many places where other types are allowed, including:</p><ul class="list-bullet">
  <li class="item"><p class="para">As a parameter type or return type in a function, method, or initializer</p></li><li class="item"><p class="para">As the type of a constant, variable, or property</p></li><li class="item"><p class="para">As the type of items in an array, dictionary, or other container</p></li>
</ul><div class="note">
  <aside class="aside">
    	<p class="aside-title uppercase">Note</p>
    	<p class="para">Because protocols are types, begin their names with a capital letter (such as <code class="code-voice">FullyNamed</code> and <code class="code-voice">RandomNumberGenerator</code>) to match the names of other types in Swift (such as <code class="code-voice">Int</code>, <code class="code-voice">String</code>, and <code class="code-voice">Double</code>).
    	</p>
    
  </aside>
</div><p class="para">Here’s an example of a protocol used as a type:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">class</code> <code class="vc">Dice</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">let</code> <code class="vc">sides</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code></code></li>
          <li><code class="code-voice">    <code class="kt">let</code> <code class="vc">generator</code>: <code class="n"><!-- a href="" logicalPath="" -->RandomNumberGenerator<!-- /a --></code></code></li>
          <li><code class="code-voice">    <code class="kt">init</code>(<code class="vc">sides</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code>, <code class="vc">generator</code>: <code class="n"><!-- a href="" logicalPath="" -->RandomNumberGenerator<!-- /a --></code>) {</code></li>
          <li><code class="code-voice">        <code class="kt">self</code>.<code class="vc">sides</code> = <code class="vc">sides</code></code></li>
          <li><code class="code-voice">        <code class="kt">self</code>.<code class="vc">generator</code> = <code class="vc">generator</code></code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">roll</code>() -&gt; <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code> {</code></li>
          <li><code class="code-voice">        <code class="kt">return</code> <code class="vc">Int</code>(<code class="vc">generator</code>.<code class="vc">random</code>() * <code class="vc">Double</code>(<code class="vc">sides</code>)) + <code class="m">1</code></code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">This example defines a new class called <code class="code-voice">Dice</code>, which represents an <em>n</em>-sided dice for use in a board game. <code class="code-voice">Dice</code> instances have an integer property called <code class="code-voice">sides</code>, which represents how many sides they have, and a property called <code class="code-voice">generator</code>, which provides a random number generator from which to create dice roll values.</p><p class="para">The <code class="code-voice">generator</code> property is of type <code class="code-voice">RandomNumberGenerator</code>. Therefore, you can set it to an instance of <em>any</em> type that adopts the <code class="code-voice">RandomNumberGenerator</code> protocol. Nothing else is required of the instance you assign to this property, except that the instance must adopt the <code class="code-voice">RandomNumberGenerator</code> protocol.</p><p class="para"><code class="code-voice">Dice</code> also has an initializer, to set up its initial state. This initializer has a parameter called <code class="code-voice">generator</code>, which is also of type <code class="code-voice">RandomNumberGenerator</code>. You can pass a value of any conforming type in to this parameter when initializing a new <code class="code-voice">Dice</code> instance.</p><p class="para"><code class="code-voice">Dice</code> provides one instance method, <code class="code-voice">roll</code>, which returns an integer value between 1 and the number of sides on the dice. This method calls the generator’s <code class="code-voice">random</code> method to create a new random number between <code class="code-voice">0.0</code> and <code class="code-voice">1.0</code>, and uses this random number to create a dice roll value within the correct range. Because <code class="code-voice">generator</code> is known to adopt <code class="code-voice">RandomNumberGenerator</code>, it is guaranteed to have a <code class="code-voice">random</code> method to call.</p><p class="para">Here’s how the <code class="code-voice">Dice</code> class can be used to create a six-sided dice with a <code class="code-voice">LinearCongruentialGenerator</code> instance as its random number generator:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">var</code> <code class="vc">d6</code> = <code class="vc">Dice</code>(<code class="vc">sides</code>: <code class="m">6</code>, <code class="vc">generator</code>: <code class="vc">LinearCongruentialGenerator</code>())</code></li>
          <li><code class="code-voice"><code class="kt">for</code> <code class="kt">_</code> <code class="kt">in</code> <code class="m">1</code>...<code class="m">5</code> {</code></li>
          <li><code class="code-voice">    <code class="vc">println</code>(<code class="s">&quot;Random dice roll is </code>\(<code class="vc">d6</code>.<code class="vc">roll</code>())<code class="s">&quot;</code>)</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="c">// Random dice roll is 3</code></code></li>
          <li><code class="code-voice"><code class="c">// Random dice roll is 5</code></code></li>
          <li><code class="code-voice"><code class="c">// Random dice roll is 4</code></code></li>
          <li><code class="code-voice"><code class="c">// Random dice roll is 5</code></code></li>
          <li><code class="code-voice"><code class="c">// Random dice roll is 4</code></code></li>
      </ul>



  </div>
</section>
  
</section>
<section class="section">
	<a id="TP40014097-CH25-XID_354">&#x200c;</a>
  <h3 class="section-name">Delegation</h3>
  <p class="para"><em>Delegation</em> is a design pattern that enables a class or structure to hand off (or <em>delegate</em>) some of its responsibilities to an instance of another type. This design pattern is implemented by defining a protocol that encapsulates the delegated responsibilities, such that a conforming type (known as a delegate) is guaranteed to provide the functionality that has been delegated. Delegation can be used to respond to a particular action, or to retrieve data from an external source without needing to know the underlying type of that source.</p><p class="para">The example below defines two protocols for use with dice-based board games:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">DiceGame</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">dice</code>: <code class="n"><!-- a href="" logicalPath="" -->Dice<!-- /a --></code> { <code class="kt">get</code> }</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">play</code>()</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">DiceGameDelegate</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">gameDidStart</code>(<code class="vc">game</code>: <code class="n"><!-- a href="" logicalPath="" -->DiceGame<!-- /a --></code>)</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">game</code>(<code class="vc">game</code>: <code class="n"><!-- a href="" logicalPath="" -->DiceGame<!-- /a --></code>, <code class="vc">didStartNewTurnWithDiceRoll</code> <code class="vc">diceRoll</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code>)</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">gameDidEnd</code>(<code class="vc">game</code>: <code class="n"><!-- a href="" logicalPath="" -->DiceGame<!-- /a --></code>)</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">The <code class="code-voice">DiceGame</code> protocol is a protocol that can be adopted by any game that involves dice. The <code class="code-voice">DiceGameDelegate</code> protocol can be adopted by any type to track the progress of a <code class="code-voice">DiceGame</code>.</p><p class="para">Here’s a version of the <em>Snakes and Ladders</em> game originally introduced in <a href="ControlFlow.xhtml" data-id="//apple_ref/doc/uid/TP40014097-CH9-XID_153" rel="me">Control Flow</a>. This version is adapted to use a <code class="code-voice">Dice</code> instance for its dice-rolls; to adopt the <code class="code-voice">DiceGame</code> protocol; and to notify a <code class="code-voice">DiceGameDelegate</code> about its progress:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">class</code> <code class="vc">SnakesAndLadders</code>: <code class="n"><!-- a href="" logicalPath="" -->DiceGame<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">let</code> <code class="vc">finalSquare</code> = <code class="m">25</code></code></li>
          <li><code class="code-voice">    <code class="kt">let</code> <code class="vc">dice</code> = <code class="vc">Dice</code>(<code class="vc">sides</code>: <code class="m">6</code>, <code class="vc">generator</code>: <code class="vc">LinearCongruentialGenerator</code>())</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">square</code> = <code class="m">0</code></code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">board</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code>[]</code></li>
          <li><code class="code-voice">    <code class="kt">init</code>() {</code></li>
          <li><code class="code-voice">        <code class="vc">board</code> = <code class="vc">Int</code>[](<code class="vc">count</code>: <code class="vc">finalSquare</code> + <code class="m">1</code>, <code class="vc">repeatedValue</code>: <code class="m">0</code>)</code></li>
          <li><code class="code-voice">        <code class="vc">board</code>[<code class="m">03</code>] = +<code class="m">08</code>; <code class="vc">board</code>[<code class="m">06</code>] = +<code class="m">11</code>; <code class="vc">board</code>[<code class="m">09</code>] = +<code class="m">09</code>; <code class="vc">board</code>[<code class="m">10</code>] = +<code class="m">02</code></code></li>
          <li><code class="code-voice">        <code class="vc">board</code>[<code class="m">14</code>] = -<code class="m">10</code>; <code class="vc">board</code>[<code class="m">19</code>] = -<code class="m">11</code>; <code class="vc">board</code>[<code class="m">22</code>] = -<code class="m">02</code>; <code class="vc">board</code>[<code class="m">24</code>] = -<code class="m">08</code></code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">delegate</code>: <code class="n"><!-- a href="" logicalPath="" -->DiceGameDelegate<!-- /a --></code>?</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">play</code>() {</code></li>
          <li><code class="code-voice">        <code class="vc">square</code> = <code class="m">0</code></code></li>
          <li><code class="code-voice">        <code class="vc">delegate</code>?.<code class="vc">gameDidStart</code>(<code class="kt">self</code>)</code></li>
          <li><code class="code-voice">        <code class="vc">gameLoop</code>: <code class="kt">while</code> <code class="vc">square</code> != <code class="vc">finalSquare</code> {</code></li>
          <li><code class="code-voice">            <code class="kt">let</code> <code class="vc">diceRoll</code> = <code class="vc">dice</code>.<code class="vc">roll</code>()</code></li>
          <li><code class="code-voice">            <code class="vc">delegate</code>?.<code class="vc">game</code>(<code class="kt">self</code>, <code class="vc">didStartNewTurnWithDiceRoll</code>: <code class="vc">diceRoll</code>)</code></li>
          <li><code class="code-voice">            <code class="kt">switch</code> <code class="vc">square</code> + <code class="vc">diceRoll</code> {</code></li>
          <li><code class="code-voice">            <code class="kt">case</code> <code class="vc">finalSquare</code>:</code></li>
          <li><code class="code-voice">                <code class="kt">break</code> <code class="vc">gameLoop</code></code></li>
          <li><code class="code-voice">            <code class="kt">case</code> <code class="kt">let</code> <code class="vc">newSquare</code> <code class="kt">where</code> <code class="vc">newSquare</code> &gt; <code class="vc">finalSquare</code>:</code></li>
          <li><code class="code-voice">                <code class="kt">continue</code> <code class="vc">gameLoop</code></code></li>
          <li><code class="code-voice">            <code class="kt">default</code>:</code></li>
          <li><code class="code-voice">                <code class="vc">square</code> += <code class="vc">diceRoll</code></code></li>
          <li><code class="code-voice">                <code class="vc">square</code> += <code class="vc">board</code>[<code class="vc">square</code>]</code></li>
          <li><code class="code-voice">            }</code></li>
          <li><code class="code-voice">        }</code></li>
          <li><code class="code-voice">        <code class="vc">delegate</code>?.<code class="vc">gameDidEnd</code>(<code class="kt">self</code>)</code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">For a description of the <em>Snakes and Ladders</em> gameplay, see the <a href="ControlFlow.xhtml#TP40014097-CH9-XID_174" data-id="//apple_ref/doc/uid/TP40014097-CH9-XID_174" rel="me">Break</a> section of the <a href="ControlFlow.xhtml" data-id="//apple_ref/doc/uid/TP40014097-CH9-XID_153" rel="me">Control Flow</a> chapter.</p><p class="para">This version of the game is wrapped up as a class called <code class="code-voice">SnakesAndLadders</code>, which adopts the <code class="code-voice">DiceGame</code> protocol. It provides a gettable <code class="code-voice">dice</code> property and a <code class="code-voice">play</code> method in order to conform to the protocol. (The <code class="code-voice">dice</code> property is declared as a constant property because it does not need to change after initialization, and the protocol only requires that it is gettable.)</p><p class="para">The <em>Snakes and Ladders</em> game board setup takes place within the class’s <code class="code-voice">init()</code> initializer. All game logic is moved into the protocol’s <code class="code-voice">play</code> method, which uses the protocol’s required <code class="code-voice">dice</code> property to provide its dice roll values.</p><p class="para">Note that the <code class="code-voice">delegate</code> property is defined as an <em>optional</em> <code class="code-voice">DiceGameDelegate</code>, because a delegate isn’t required in order to play the game. Because it is of an optional type, the <code class="code-voice">delegate</code> property is automatically set to an initial value of <code class="code-voice">nil</code>. Thereafter, the game instantiator has the option to set the property to a suitable delegate.</p><p class="para"><code class="code-voice">DiceGameDelegate</code> provides three methods for tracking the progress of a game. These three methods have been incorporated into the game logic within the <code class="code-voice">play</code> method above, and are called when a new game starts, a new turn begins, or the game ends.</p><p class="para">Because the <code class="code-voice">delegate</code> property is an <em>optional</em> <code class="code-voice">DiceGameDelegate</code>, the <code class="code-voice">play</code> method uses optional chaining each time it calls a method on the delegate. If the <code class="code-voice">delegate</code> property is nil, these delegate calls fail gracefully and without error. If the <code class="code-voice">delegate</code> property is non-nil, the delegate methods are called, and are passed the <code class="code-voice">SnakesAndLadders</code> instance as a parameter.</p><p class="para">This next example shows a class called <code class="code-voice">DiceGameTracker</code>, which adopts the <code class="code-voice">DiceGameDelegate</code> protocol:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">class</code> <code class="vc">DiceGameTracker</code>: <code class="n"><!-- a href="" logicalPath="" -->DiceGameDelegate<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">numberOfTurns</code> = <code class="m">0</code></code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">gameDidStart</code>(<code class="vc">game</code>: <code class="n"><!-- a href="" logicalPath="" -->DiceGame<!-- /a --></code>) {</code></li>
          <li><code class="code-voice">        <code class="vc">numberOfTurns</code> = <code class="m">0</code></code></li>
          <li><code class="code-voice">        <code class="kt">if</code> <code class="vc">game</code> <code class="kt">is</code> <code class="n"><!-- a href="" logicalPath="" -->SnakesAndLadders<!-- /a --></code> {</code></li>
          <li><code class="code-voice">            <code class="vc">println</code>(<code class="s">&quot;Started a new game of Snakes and Ladders&quot;</code>)</code></li>
          <li><code class="code-voice">        }</code></li>
          <li><code class="code-voice">        <code class="vc">println</code>(<code class="s">&quot;The game is using a </code>\(<code class="vc">game</code>.<code class="vc">dice</code>.<code class="vc">sides</code>)<code class="s">-sided dice&quot;</code>)</code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">game</code>(<code class="vc">game</code>: <code class="n"><!-- a href="" logicalPath="" -->DiceGame<!-- /a --></code>, <code class="vc">didStartNewTurnWithDiceRoll</code> <code class="vc">diceRoll</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code>) {</code></li>
          <li><code class="code-voice">        ++<code class="vc">numberOfTurns</code></code></li>
          <li><code class="code-voice">        <code class="vc">println</code>(<code class="s">&quot;Rolled a </code>\(<code class="vc">diceRoll</code>)<code class="s">&quot;</code>)</code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">gameDidEnd</code>(<code class="vc">game</code>: <code class="n"><!-- a href="" logicalPath="" -->DiceGame<!-- /a --></code>) {</code></li>
          <li><code class="code-voice">        <code class="vc">println</code>(<code class="s">&quot;The game lasted for </code>\(<code class="vc">numberOfTurns</code>)<code class="s"> turns&quot;</code>)</code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para"><code class="code-voice">DiceGameTracker</code> implements all three methods required by <code class="code-voice">DiceGameDelegate</code>. It uses these methods to keep track of the number of turns a game has taken. It resets a <code class="code-voice">numberOfTurns</code> property to zero when the game starts; increments it each time a new turn begins; and prints out the total number of turns once the game has ended.</p><p class="para">The implementation of <code class="code-voice">gameDidStart</code> shown above uses the <code class="code-voice">game</code> parameter to print some introductory information about the game that is about to be played. The <code class="code-voice">game</code> parameter has a type of <code class="code-voice">DiceGame</code>, not <code class="code-voice">SnakesAndLadders</code>, and so <code class="code-voice">gameDidStart</code> can access and use only methods and properties that are implemented as part of the <code class="code-voice">DiceGame</code> protocol. However, the method is still able to use type casting to query the type of the underlying instance. In this example, it checks whether <code class="code-voice">game</code> is actually an instance of <code class="code-voice">SnakesAndLadders</code> behind the scenes, and prints an appropriate message if so.</p><p class="para"><code class="code-voice">gameDidStart</code> also accesses the <code class="code-voice">dice</code> property of the passed <code class="code-voice">game</code> parameter. Because <code class="code-voice">game</code> is known to conform to the <code class="code-voice">DiceGame</code> protocol, it is guaranteed to have a <code class="code-voice">dice</code> property, and so the <code class="code-voice">gameDidStart</code> method is able to access and print the dice’s <code class="code-voice">sides</code> property, regardless of what kind of game is being played.</p><p class="para">Here’s how <code class="code-voice">DiceGameTracker</code> looks in action:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">let</code> <code class="vc">tracker</code> = <code class="vc">DiceGameTracker</code>()</code></li>
          <li><code class="code-voice"><code class="kt">let</code> <code class="vc">game</code> = <code class="vc">SnakesAndLadders</code>()</code></li>
          <li><code class="code-voice"><code class="vc">game</code>.<code class="vc">delegate</code> = <code class="vc">tracker</code></code></li>
          <li><code class="code-voice"><code class="vc">game</code>.<code class="vc">play</code>()</code></li>
          <li><code class="code-voice"><code class="c">// Started a new game of Snakes and Ladders</code></code></li>
          <li><code class="code-voice"><code class="c">// The game is using a 6-sided dice</code></code></li>
          <li><code class="code-voice"><code class="c">// Rolled a 3</code></code></li>
          <li><code class="code-voice"><code class="c">// Rolled a 5</code></code></li>
          <li><code class="code-voice"><code class="c">// Rolled a 4</code></code></li>
          <li><code class="code-voice"><code class="c">// Rolled a 5</code></code></li>
          <li><code class="code-voice"><code class="c">// The game lasted for 4 turns</code></code></li>
      </ul>



  </div>
</section>
  
</section>
<section class="section">
	<a id="TP40014097-CH25-XID_355">&#x200c;</a>
  <h3 class="section-name">Adding Protocol Conformance with an Extension</h3>
  <p class="para">You can extend an existing type to adopt and conform to a new protocol, even if you do not have access to the source code for the existing type. Extensions can add new properties, methods, and subscripts to an existing type, and are therefore able to add any requirements that a protocol may demand. For more about extensions, see <a href="Extensions.xhtml" data-id="//apple_ref/doc/uid/TP40014097-CH24-XID_191" rel="me">Extensions</a>.</p><div class="note">
  <aside class="aside">
    	<p class="aside-title uppercase">Note</p>
    	<p class="para">Existing instances of a type automatically adopt and conform to a protocol when that conformance is added to the instance’s type in an extension.
    	</p>
    
  </aside>
</div><p class="para">For example, this protocol, called <code class="code-voice">TextRepresentable</code>, can be implemented by any type that has a way to be represented as text. This might be a description of itself, or a text version of its current state:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">TextRepresentable</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">asText</code>() -&gt; <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code></code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">The <code class="code-voice">Dice</code> class from earlier can be extended to adopt and conform to <code class="code-voice">TextRepresentable</code>:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">extension</code> <code class="n"><!-- a href="" logicalPath="" -->Dice<!-- /a --></code>: <code class="n"><!-- a href="" logicalPath="" -->TextRepresentable<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">asText</code>() -&gt; <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code> {</code></li>
          <li><code class="code-voice">        <code class="kt">return</code> <code class="s">&quot;A </code>\(<code class="vc">sides</code>)<code class="s">-sided dice&quot;</code></code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">This extension adopts the new protocol in exactly the same way as if <code class="code-voice">Dice</code> had provided it in its original implementation. The protocol name is provided after the type name, separated by a colon, and an implementation of all requirements of the protocol is provided within the extension’s curly braces.</p><p class="para">Any <code class="code-voice">Dice</code> instance can now be treated as <code class="code-voice">TextRepresentable</code>:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">let</code> <code class="vc">d12</code> = <code class="vc">Dice</code>(<code class="vc">sides</code>: <code class="m">12</code>, <code class="vc">generator</code>: <code class="vc">LinearCongruentialGenerator</code>())</code></li>
          <li><code class="code-voice"><code class="vc">println</code>(<code class="vc">d12</code>.<code class="vc">asText</code>())</code></li>
          <li><code class="code-voice"><code class="c">// prints &quot;A 12-sided dice&quot;</code></code></li>
      </ul>



  </div>
</section><p class="para">Similarly, the <code class="code-voice">SnakesAndLadders</code> game class can be extended to adopt and conform to the <code class="code-voice">TextRepresentable</code> protocol:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">extension</code> <code class="n"><!-- a href="" logicalPath="" -->SnakesAndLadders<!-- /a --></code>: <code class="n"><!-- a href="" logicalPath="" -->TextRepresentable<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">asText</code>() -&gt; <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code> {</code></li>
          <li><code class="code-voice">        <code class="kt">return</code> <code class="s">&quot;A game of Snakes and Ladders with </code>\(<code class="vc">finalSquare</code>)<code class="s"> squares&quot;</code></code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="vc">println</code>(<code class="vc">game</code>.<code class="vc">asText</code>())</code></li>
          <li><code class="code-voice"><code class="c">// prints &quot;A game of Snakes and Ladders with 25 squares&quot;</code></code></li>
      </ul>



  </div>
</section>
  <section class="section">
	<a id="TP40014097-CH25-XID_357">&#x200c;</a>
  <h3 class="section-name">Declaring Protocol Adoption with an Extension</h3>
  <p class="para">If a type already conforms to all of the requirements of a protocol, but has not yet stated that it adopts that protocol, you can make it adopt the protocol with an empty extension:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">struct</code> <code class="vc">Hamster</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">name</code>: <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code></code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">asText</code>() -&gt; <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code> {</code></li>
          <li><code class="code-voice">        <code class="kt">return</code> <code class="s">&quot;A hamster named </code>\(<code class="vc">name</code>)<code class="s">&quot;</code></code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="kt">extension</code> <code class="n"><!-- a href="" logicalPath="" -->Hamster<!-- /a --></code>: <code class="n"><!-- a href="" logicalPath="" -->TextRepresentable<!-- /a --></code> {}</code></li>
      </ul>



  </div>
</section><p class="para">Instances of <code class="code-voice">Hamster</code> can now be used wherever <code class="code-voice">TextRepresentable</code> is the required type:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">let</code> <code class="vc">simonTheHamster</code> = <code class="vc">Hamster</code>(<code class="vc">name</code>: <code class="s">&quot;Simon&quot;</code>)</code></li>
          <li><code class="code-voice"><code class="kt">let</code> <code class="vc">somethingTextRepresentable</code>: <code class="n"><!-- a href="" logicalPath="" -->TextRepresentable<!-- /a --></code> = <code class="vc">simonTheHamster</code></code></li>
          <li><code class="code-voice"><code class="vc">println</code>(<code class="vc">somethingTextRepresentable</code>.<code class="vc">asText</code>())</code></li>
          <li><code class="code-voice"><code class="c">// prints &quot;A hamster named Simon&quot;</code></code></li>
      </ul>



  </div>
</section><div class="note">
  <aside class="aside">
    	<p class="aside-title uppercase">Note</p>
    	<p class="para">Types do not automatically adopt a protocol just by satisfying its requirements. They must always explicitly declare their adoption of the protocol.
    	</p>
    
  </aside>
</div>
  
</section>

</section>
<section class="section">
	<a id="TP40014097-CH25-XID_359">&#x200c;</a>
  <h3 class="section-name">Collections of Protocol Types</h3>
  <p class="para">A protocol can be used as the type to be stored in a collection such as an array or a dictionary, as mentioned in <a href="Protocols.xhtml#TP40014097-CH25-XID_352" data-id="//apple_ref/doc/uid/TP40014097-CH25-XID_352" rel="me">Protocols as Types</a>. This example creates an array of <code class="code-voice">TextRepresentable</code> things:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">let</code> <code class="vc">things</code>: <code class="n"><!-- a href="" logicalPath="" -->TextRepresentable<!-- /a --></code>[] = [<code class="vc">game</code>, <code class="vc">d12</code>, <code class="vc">simonTheHamster</code>]</code></li>
      </ul>



  </div>
</section><p class="para">It is now possible to iterate over the items in the array, and print each item’s textual representation:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">for</code> <code class="vc">thing</code> <code class="kt">in</code> <code class="vc">things</code> {</code></li>
          <li><code class="code-voice">    <code class="vc">println</code>(<code class="vc">thing</code>.<code class="vc">asText</code>())</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="c">// A game of Snakes and Ladders with 25 squares</code></code></li>
          <li><code class="code-voice"><code class="c">// A 12-sided dice</code></code></li>
          <li><code class="code-voice"><code class="c">// A hamster named Simon</code></code></li>
      </ul>



  </div>
</section><p class="para">Note that the <code class="code-voice">thing</code> constant is of type <code class="code-voice">TextRepresentable</code>. It is not of type <code class="code-voice">Dice</code>, or <code class="code-voice">DiceGame</code>, or <code class="code-voice">Hamster</code>, even if the actual instance behind the scenes is of one of those types. Nonetheless, because it is of type <code class="code-voice">TextRepresentable</code>, and anything that is <code class="code-voice">TextRepresentable</code> is known to have an <code class="code-voice">asText</code> method, it is safe to call <code class="code-voice">thing.asText</code> each time through the loop.</p>
  
</section>
<section class="section">
	<a id="TP40014097-CH25-XID_360">&#x200c;</a>
  <h3 class="section-name">Protocol Inheritance</h3>
  <p class="para">A protocol can <em>inherit</em> one or more other protocols and can add further requirements on top of the requirements it inherits. The syntax for protocol inheritance is similar to the syntax for class inheritance, but with the option to list multiple inherited protocols, separated by commas:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">InheritingProtocol</code>: <code class="n"><!-- a href="" logicalPath="" -->SomeProtocol<!-- /a --></code>, <code class="n"><!-- a href="" logicalPath="" -->AnotherProtocol<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="c">// protocol definition goes here</code></code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">Here’s an example of a protocol that inherits the <code class="code-voice">TextRepresentable</code> protocol from above:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">PrettyTextRepresentable</code>: <code class="n"><!-- a href="" logicalPath="" -->TextRepresentable<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">asPrettyText</code>() -&gt; <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code></code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">This example defines a new protocol, <code class="code-voice">PrettyTextRepresentable</code>, which inherits from <code class="code-voice">TextRepresentable</code>. Anything that adopts <code class="code-voice">PrettyTextRepresentable</code> must satisfy all of the requirements enforced by <code class="code-voice">TextRepresentable</code>, <em>plus</em> the additional requirements enforced by <code class="code-voice">PrettyTextRepresentable</code>. In this example, <code class="code-voice">PrettyTextRepresentable</code> adds a single requirement to provide an instance method called <code class="code-voice">asPrettyText</code> that returns a <code class="code-voice">String</code>.</p><p class="para">The <code class="code-voice">SnakesAndLadders</code> class can be extended to adopt and conform to <code class="code-voice">PrettyTextRepresentable</code>:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">extension</code> <code class="n"><!-- a href="" logicalPath="" -->SnakesAndLadders<!-- /a --></code>: <code class="n"><!-- a href="" logicalPath="" -->PrettyTextRepresentable<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">asPrettyText</code>() -&gt; <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code> {</code></li>
          <li><code class="code-voice">        <code class="kt">var</code> <code class="vc">output</code> = <code class="vc">asText</code>() + <code class="s">&quot;:\n&quot;</code></code></li>
          <li><code class="code-voice">        <code class="kt">for</code> <code class="vc">index</code> <code class="kt">in</code> <code class="m">1</code>...<code class="vc">finalSquare</code> {</code></li>
          <li><code class="code-voice">            <code class="kt">switch</code> <code class="vc">board</code>[<code class="vc">index</code>] {</code></li>
          <li><code class="code-voice">            <code class="kt">case</code> <code class="kt">let</code> <code class="vc">ladder</code> <code class="kt">where</code> <code class="vc">ladder</code> &gt; <code class="m">0</code>:</code></li>
          <li><code class="code-voice">                <code class="vc">output</code> += <code class="s">&quot;▲ &quot;</code></code></li>
          <li><code class="code-voice">            <code class="kt">case</code> <code class="kt">let</code> <code class="vc">snake</code> <code class="kt">where</code> <code class="vc">snake</code> &lt; <code class="m">0</code>:</code></li>
          <li><code class="code-voice">                <code class="vc">output</code> += <code class="s">&quot;▼ &quot;</code></code></li>
          <li><code class="code-voice">            <code class="kt">default</code>:</code></li>
          <li><code class="code-voice">                <code class="vc">output</code> += <code class="s">&quot;○ &quot;</code></code></li>
          <li><code class="code-voice">            }</code></li>
          <li><code class="code-voice">        }</code></li>
          <li><code class="code-voice">        <code class="kt">return</code> <code class="vc">output</code></code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">This extension states that it adopts the <code class="code-voice">PrettyTextRepresentable</code> protocol and provides an implementation of the <code class="code-voice">asPrettyText</code> method for the <code class="code-voice">SnakesAndLadders</code> type. Anything that is <code class="code-voice">PrettyTextRepresentable</code> must also be <code class="code-voice">TextRepresentable</code>, and so the <code class="code-voice">asPrettyText</code> implementation starts by calling the <code class="code-voice">asText</code> method from the <code class="code-voice">TextRepresentable</code> protocol to begin an output string. It appends a colon and a line break, and uses this as the start of its pretty text representation. It then iterates through the array of board squares, and appends an emoji representation for each square:</p><ul class="list-bullet">
  <li class="item"><p class="para">If the square’s value is greater than <code class="code-voice">0</code>, it is the base of a ladder, and is represented by <code class="code-voice">▲</code>.</p></li><li class="item"><p class="para">If the square’s value is less than <code class="code-voice">0</code>, it is the head of a snake, and is represented by <code class="code-voice">▼</code>.</p></li><li class="item"><p class="para">Otherwise, the square’s value is <code class="code-voice">0</code>, and it is a “free” square, represented by <code class="code-voice">○</code>.</p></li>
</ul><p class="para">The method implementation can now be used to print a pretty text description of any <code class="code-voice">SnakesAndLadders</code> instance:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="vc">println</code>(<code class="vc">game</code>.<code class="vc">asPrettyText</code>())</code></li>
          <li><code class="code-voice"><code class="c">// A game of Snakes and Ladders with 25 squares:</code></code></li>
          <li><code class="code-voice"><code class="c">// ○ ○ ▲ ○ ○ ▲ ○ ○ ▲ ▲ ○ ○ ○ ▼ ○ ○ ○ ○ ▼ ○ ○ ▼ ○ ▼ ○</code></code></li>
      </ul>



  </div>
</section>
  
</section>
<section class="section">
	<a id="TP40014097-CH25-XID_361">&#x200c;</a>
  <h3 class="section-name">Protocol Composition</h3>
  <p class="para">It can be useful to require a type to conform to multiple protocols at once. You can combine multiple protocols into a single requirement with a <em>protocol composition</em>. Protocol compositions have the form <code class="code-voice">protocol&lt;SomeProtocol, AnotherProtocol&gt;</code>. You can list as many protocols within the pair of angle brackets (<code class="code-voice">&lt;&gt;</code>) as you need, separated by commas.</p><p class="para">Here’s an example that combines two protocols called <code class="code-voice">Named</code> and <code class="code-voice">Aged</code> into a single protocol composition requirement on a function parameter:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">Named</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">name</code>: <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code> { <code class="kt">get</code> }</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="kt">protocol</code> <code class="vc">Aged</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">age</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code> { <code class="kt">get</code> }</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="kt">struct</code> <code class="vc">Person</code>: <code class="n"><!-- a href="" logicalPath="" -->Named<!-- /a --></code>, <code class="n"><!-- a href="" logicalPath="" -->Aged<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">name</code>: <code class="n"><!-- a href="" logicalPath="" -->String<!-- /a --></code></code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">age</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code></code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="kt">func</code> <code class="vc">wishHappyBirthday</code>(<code class="vc">celebrator</code>: <code class="kt">protocol</code>&lt;<code class="n"><!-- a href="" logicalPath="" -->Named<!-- /a --></code>, <code class="n"><!-- a href="" logicalPath="" -->Aged<!-- /a --></code>&gt;) {</code></li>
          <li><code class="code-voice">    <code class="vc">println</code>(<code class="s">&quot;Happy birthday </code>\(<code class="vc">celebrator</code>.<code class="vc">name</code>)<code class="s"> - you're </code>\(<code class="vc">celebrator</code>.<code class="vc">age</code>)<code class="s">!&quot;</code>)</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="kt">let</code> <code class="vc">birthdayPerson</code> = <code class="vc">Person</code>(<code class="vc">name</code>: <code class="s">&quot;Malcolm&quot;</code>, <code class="vc">age</code>: <code class="m">21</code>)</code></li>
          <li><code class="code-voice"><code class="vc">wishHappyBirthday</code>(<code class="vc">birthdayPerson</code>)</code></li>
          <li><code class="code-voice"><code class="c">// prints &quot;Happy birthday Malcolm - you're 21!&quot;</code></code></li>
      </ul>



  </div>
</section><p class="para">This example defines a protocol called <code class="code-voice">Named</code>, with a single requirement for a gettable <code class="code-voice">String</code> property called <code class="code-voice">name</code>. It also defines a protocol called <code class="code-voice">Aged</code>, with a single requirement for a gettable <code class="code-voice">Int</code> property called <code class="code-voice">age</code>. Both of these protocols are adopted by a structure called <code class="code-voice">Person</code>.</p><p class="para">The example also defines a function called <code class="code-voice">wishHappyBirthday</code>, which takes a single parameter called <code class="code-voice">celebrator</code>. The type of this parameter is <code class="code-voice">protocol&lt;Named, Aged&gt;</code>, which means “any type that conforms to both the <code class="code-voice">Named</code> and <code class="code-voice">Aged</code> protocols.” It doesn’t matter what specific type is passed to the function, as long as it conforms to both of the required protocols.</p><p class="para">The example then creates a new <code class="code-voice">Person</code> instance called <code class="code-voice">birthdayPerson</code> and passes this new instance to the <code class="code-voice">wishHappyBirthday</code> function. Because <code class="code-voice">Person</code> conforms to both protocols, this is a valid call, and the <code class="code-voice">wishHappyBirthday</code> function is able to print its birthday greeting.</p><div class="note">
  <aside class="aside">
    	<p class="aside-title uppercase">Note</p>
    	<p class="para">Protocol compositions do not define a new, permanent protocol type. Rather, they define a temporary local protocol that has the combined requirements of all protocols in the composition.
    	</p>
    
  </aside>
</div>
  
</section>
<section class="section">
	<a id="TP40014097-CH25-XID_363">&#x200c;</a>
  <h3 class="section-name">Checking for Protocol Conformance</h3>
  <p class="para">You can use the <code class="code-voice">is</code> and <code class="code-voice">as</code> operators described in <a href="TypeCasting.xhtml" data-id="//apple_ref/doc/uid/TP40014097-CH22-XID_443" rel="me">Type Casting</a> to check for protocol conformance, and to cast to a specific protocol. Checking for and casting to a protocol follows exactly the same syntax as checking for and casting to a type:</p><ul class="list-bullet">
  <li class="item"><p class="para">The <code class="code-voice">is</code> operator returns <code class="code-voice">true</code> if an instance conforms to a protocol and returns <code class="code-voice">false</code> if it does not.</p></li><li class="item"><p class="para">The <code class="code-voice">as?</code> version of the downcast operator returns an optional value of the protocol’s type, and this value is <code class="code-voice">nil</code> if the instance does not conform to that protocol.</p></li><li class="item"><p class="para">The <code class="code-voice">as</code> version of the downcast operator forces the downcast to the protocol type and triggers a runtime error if the downcast does not succeed.</p></li>
</ul><p class="para">This example defines a protocol called <code class="code-voice">HasArea</code>, with a single property requirement of a gettable <code class="code-voice">Double</code> property called <code class="code-voice">area</code>:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">@objc</code> <code class="kt">protocol</code> <code class="vc">HasArea</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">area</code>: <code class="n"><!-- a href="" logicalPath="" -->Double<!-- /a --></code> { <code class="kt">get</code> }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><div class="note">
  <aside class="aside">
    	<p class="aside-title uppercase">Note</p>
    	<p class="para">You can check for protocol conformance only if your protocol is marked with the <code class="code-voice">@objc</code> attribute, as seen for the <code class="code-voice">HasArea</code> protocol above. This attribute indicates that the protocol should be exposed to Objective-C code and is described in <em class="u-book"><!-- a href="" target="_self" logicalPath="//apple_ref/doc/uid/TP40014216" -->Using Swift with Cocoa and Objective-C<!-- /a --></em>. Even if you are not interoperating with Objective-C, you need to mark your protocols with the <code class="code-voice">@objc</code> attribute if you want to be able to check for protocol conformance.
    	</p>
    <p class="para">Note also that <code class="code-voice">@objc</code> protocols can be adopted only by classes, and not by structures or enumerations. If you mark your protocol as <code class="code-voice">@objc</code> in order to check for conformance, you will be able to apply that protocol only to class types.</p>
  </aside>
</div><p class="para">Here are two classes, <code class="code-voice">Circle</code> and <code class="code-voice">Country</code>, both of which conform to the <code class="code-voice">HasArea</code> protocol:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">class</code> <code class="vc">Circle</code>: <code class="n"><!-- a href="" logicalPath="" -->HasArea<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">let</code> <code class="vc">pi</code> = <code class="m">3.1415927</code></code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">radius</code>: <code class="n"><!-- a href="" logicalPath="" -->Double<!-- /a --></code></code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">area</code>: <code class="n"><!-- a href="" logicalPath="" -->Double<!-- /a --></code> { <code class="kt">return</code> <code class="vc">pi</code> * <code class="vc">radius</code> * <code class="vc">radius</code> }</code></li>
          <li><code class="code-voice">    <code class="kt">init</code>(<code class="vc">radius</code>: <code class="n"><!-- a href="" logicalPath="" -->Double<!-- /a --></code>) { <code class="kt">self</code>.<code class="vc">radius</code> = <code class="vc">radius</code> }</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="kt">class</code> <code class="vc">Country</code>: <code class="n"><!-- a href="" logicalPath="" -->HasArea<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">area</code>: <code class="n"><!-- a href="" logicalPath="" -->Double<!-- /a --></code></code></li>
          <li><code class="code-voice">    <code class="kt">init</code>(<code class="vc">area</code>: <code class="n"><!-- a href="" logicalPath="" -->Double<!-- /a --></code>) { <code class="kt">self</code>.<code class="vc">area</code> = <code class="vc">area</code> }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">The <code class="code-voice">Circle</code> class implements the <code class="code-voice">area</code> property requirement as a computed property, based on a stored <code class="code-voice">radius</code> property. The <code class="code-voice">Country</code> class implements the <code class="code-voice">area</code> requirement directly as a stored property. Both classes correctly conform to the <code class="code-voice">HasArea</code> protocol.</p><p class="para">Here’s a class called <code class="code-voice">Animal</code>, which does not conform to the <code class="code-voice">HasArea</code> protocol:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">class</code> <code class="vc">Animal</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">legs</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code></code></li>
          <li><code class="code-voice">    <code class="kt">init</code>(<code class="vc">legs</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code>) { <code class="kt">self</code>.<code class="vc">legs</code> = <code class="vc">legs</code> }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">The <code class="code-voice">Circle</code>, <code class="code-voice">Country</code> and <code class="code-voice">Animal</code> classes do not have a shared base class. Nonetheless, they are all classes, and so instances of all three types can be used to initialize an array that stores values of type <code class="code-voice">AnyObject</code>:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">let</code> <code class="vc">objects</code>: <code class="n"><!-- a href="" logicalPath="" -->AnyObject<!-- /a --></code>[] = [</code></li>
          <li><code class="code-voice">    <code class="vc">Circle</code>(<code class="vc">radius</code>: <code class="m">2.0</code>),</code></li>
          <li><code class="code-voice">    <code class="vc">Country</code>(<code class="vc">area</code>: <code class="m">243_610</code>),</code></li>
          <li><code class="code-voice">    <code class="vc">Animal</code>(<code class="vc">legs</code>: <code class="m">4</code>)</code></li>
          <li><code class="code-voice">]</code></li>
      </ul>



  </div>
</section><p class="para">The <code class="code-voice">objects</code> array is initialized with an array literal containing a <code class="code-voice">Circle</code> instance with a radius of 2 units; a <code class="code-voice">Country</code> instance initialized with the surface area of the United Kingdom in square kilometers; and an <code class="code-voice">Animal</code> instance with four legs.</p><p class="para">The <code class="code-voice">objects</code> array can now be iterated, and each object in the array can be checked to see if it conforms to the <code class="code-voice">HasArea</code> protocol:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">for</code> <code class="vc">object</code> <code class="kt">in</code> <code class="vc">objects</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">if</code> <code class="kt">let</code> <code class="vc">objectWithArea</code> = <code class="vc">object</code> <code class="kt">as</code>? <code class="n"><!-- a href="" logicalPath="" -->HasArea<!-- /a --></code> {</code></li>
          <li><code class="code-voice">        <code class="vc">println</code>(<code class="s">&quot;Area is </code>\(<code class="vc">objectWithArea</code>.<code class="vc">area</code>)<code class="s">&quot;</code>)</code></li>
          <li><code class="code-voice">    } <code class="kt">else</code> {</code></li>
          <li><code class="code-voice">        <code class="vc">println</code>(<code class="s">&quot;Something that doesn't have an area&quot;</code>)</code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="c">// Area is 12.5663708</code></code></li>
          <li><code class="code-voice"><code class="c">// Area is 243610.0</code></code></li>
          <li><code class="code-voice"><code class="c">// Something that doesn't have an area</code></code></li>
      </ul>



  </div>
</section><p class="para">Whenever an object in the array conforms to the <code class="code-voice">HasArea</code> protocol, the optional value returned by the <code class="code-voice">as?</code> operator is unwrapped with optional binding into a constant called <code class="code-voice">objectWithArea</code>. The <code class="code-voice">objectWithArea</code> constant is known to be of type <code class="code-voice">HasArea</code>, and so its <code class="code-voice">area</code> property can be accessed and printed in a type-safe way.</p><p class="para">Note that the underlying objects are not changed by the casting process. They continue to be a <code class="code-voice">Circle</code>, a <code class="code-voice">Country</code> and an <code class="code-voice">Animal</code>. However, at the point that they are stored in the <code class="code-voice">objectWithArea</code> constant, they are only known to be of type <code class="code-voice">HasArea</code>, and so only their <code class="code-voice">area</code> property can be accessed.</p>
  
</section>
<section class="section">
	<a id="TP40014097-CH25-XID_365">&#x200c;</a>
  <h3 class="section-name">Optional Protocol Requirements</h3>
  <p class="para">You can define <em>optional requirements</em> for protocols, These requirements do not have to be implemented by types that conform to the protocol. Optional requirements are prefixed by the <code class="code-voice">@optional</code> keyword as part of the protocol’s definition.</p><p class="para">An optional protocol requirement can be called with optional chaining, to account for the possibility that the requirement was not implemented by a type that conforms to the protocol. For information on optional chaining, see <a href="OptionalChaining.xhtml" data-id="//apple_ref/doc/uid/TP40014097-CH21-XID_312" rel="me">Optional Chaining</a>.</p><p class="para">You check for an implementation of an optional requirement by writing a question mark after the name of the requirement when it is called, such as <code class="code-voice">someOptionalMethod?(someArgument)</code>. Optional property requirements, and optional method requirements that return a value, will always return an optional value of the appropriate type when they are accessed or called, to reflect the fact that the optional requirement may not have been implemented.</p><div class="note">
  <aside class="aside">
    	<p class="aside-title uppercase">Note</p>
    	<p class="para">Optional protocol requirements can only be specified if your protocol is marked with the <code class="code-voice">@objc</code> attribute. Even if you are not interoperating with Objective-C, you need to mark your protocols with the <code class="code-voice">@objc</code> attribute if you want to specify optional requirements.
    	</p>
    <p class="para">Note also that <code class="code-voice">@objc</code> protocols can be adopted only by classes, and not by structures or enumerations. If you mark your protocol as <code class="code-voice">@objc</code> in order to specify optional requirements, you will only be able to apply that protocol to class types.</p>
  </aside>
</div><p class="para">The following example defines an integer-counting class called <code class="code-voice">Counter</code>, which uses an external data source to provide its increment amount. This data source is defined by the <code class="code-voice">CounterDataSource</code> protocol, which has two optional requirements:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">@objc</code> <code class="kt">protocol</code> <code class="vc">CounterDataSource</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">@optional</code> <code class="kt">func</code> <code class="vc">incrementForCount</code>(<code class="vc">count</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code>) -&gt; <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code></code></li>
          <li><code class="code-voice">    <code class="kt">@optional</code> <code class="kt">var</code> <code class="vc">fixedIncrement</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code> { <code class="kt">get</code> }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">The <code class="code-voice">CounterDataSource</code> protocol defines an optional method requirement called <code class="code-voice">incrementForCount</code> and an optional property requirement called <code class="code-voice">fixedIncrement</code>. These requirements define two different ways for data sources to provide an appropriate increment amount for a <code class="code-voice">Counter</code> instance.</p><div class="note">
  <aside class="aside">
    	<p class="aside-title uppercase">Note</p>
    	<p class="para">Strictly speaking, you can write a custom class that conforms to <code class="code-voice">CounterDataSource</code> without implementing <em>either</em> protocol requirement. They are both optional, after all. Although technically allowed, this wouldn’t make for a very good data source.
    	</p>
    
  </aside>
</div><p class="para">The <code class="code-voice">Counter</code> class, defined below, has an optional <code class="code-voice">dataSource</code> property of type <code class="code-voice">CounterDataSource?</code>:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">@objc</code> <code class="kt">class</code> <code class="vc">Counter</code> {</code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">count</code> = <code class="m">0</code></code></li>
          <li><code class="code-voice">    <code class="kt">var</code> <code class="vc">dataSource</code>: <code class="n"><!-- a href="" logicalPath="" -->CounterDataSource<!-- /a --></code>?</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">increment</code>() {</code></li>
          <li><code class="code-voice">        <code class="kt">if</code> <code class="kt">let</code> <code class="vc">amount</code> = <code class="vc">dataSource</code>?.<code class="vc">incrementForCount</code>?(<code class="vc">count</code>) {</code></li>
          <li><code class="code-voice">            <code class="vc">count</code> += <code class="vc">amount</code></code></li>
          <li><code class="code-voice">        } <code class="kt">else</code> <code class="kt">if</code> <code class="kt">let</code> <code class="vc">amount</code> = <code class="vc">dataSource</code>?.<code class="vc">fixedIncrement</code>? {</code></li>
          <li><code class="code-voice">            <code class="vc">count</code> += <code class="vc">amount</code></code></li>
          <li><code class="code-voice">        }</code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">The <code class="code-voice">Counter</code> class stores its current value in a variable property called <code class="code-voice">count</code>. The <code class="code-voice">Counter</code> class also defines a method called <code class="code-voice">increment</code>, which increments the <code class="code-voice">count</code> property every time the method is called.</p><p class="para">The <code class="code-voice">increment</code> method first tries to retrieve an increment amount by looking for an implementation of the <code class="code-voice">incrementForCount</code> method on its data source. The <code class="code-voice">increment</code> method uses optional chaining to try to call <code class="code-voice">incrementForCount</code>, and passes the current <code class="code-voice">count</code> value as the method’s single argument.</p><p class="para">Note <em>two</em> levels of optional chaining at play here. Firstly, it is possible that <code class="code-voice">dataSource</code> may be <code class="code-voice">nil</code>, and so <code class="code-voice">dataSource</code> has a question mark after its name to indicate that <code class="code-voice">incrementForCount</code> should only be called if <code class="code-voice">dataSource</code> is non-nil. Secondly, even if <code class="code-voice">dataSource</code> <em>does</em> exist, there is no guarantee that it implements <code class="code-voice">incrementForCount</code>, because it is an optional requirement. This is why <code class="code-voice">incrementForCount</code> is also written with a question mark after its name.</p><p class="para">Because the call to <code class="code-voice">incrementForCount</code> can fail for either of these two reasons, the call returns an <em>optional</em> <code class="code-voice">Int</code> value. This is true even though <code class="code-voice">incrementForCount</code> is defined as returning a non-optional <code class="code-voice">Int</code> value in the definition of <code class="code-voice">CounterDataSource</code>.</p><p class="para">After calling <code class="code-voice">incrementForCount</code>, the optional <code class="code-voice">Int</code> that it returns is unwrapped into a constant called <code class="code-voice">amount</code>, using optional binding. If the optional <code class="code-voice">Int</code> does contain a value—that is, if the delegate and method both exist, and the method returned a value—the unwrapped <code class="code-voice">amount</code> is added onto the stored <code class="code-voice">count</code> property, and incrementation is complete.</p><p class="para">If it is <em>not</em> possible to retrieve a value from the <code class="code-voice">incrementForCount</code> method—either because <code class="code-voice">dataSource</code> is nil, or because the data source does not implement <code class="code-voice">incrementForCount</code>—then the <code class="code-voice">increment</code> method tries to retrieve a value from the data source’s <code class="code-voice">fixedIncrement</code> property instead. The <code class="code-voice">fixedIncrement</code> property is also an optional requirement, and so its name is also written using optional chaining with a question mark on the end, to indicate that the attempt to access the property’s value can fail. As before, the returned value is an optional <code class="code-voice">Int</code> value, even though <code class="code-voice">fixedIncrement</code> is defined as a non-optional <code class="code-voice">Int</code> property as part of the <code class="code-voice">CounterDataSource</code> protocol definition.</p><p class="para">Here’s a simple <code class="code-voice">CounterDataSource</code> implementation where the data source returns a constant value of <code class="code-voice">3</code> every time it is queried. It does this by implementing the optional <code class="code-voice">fixedIncrement</code> property requirement:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">class</code> <code class="vc">ThreeSource</code>: <code class="n"><!-- a href="" logicalPath="" -->CounterDataSource<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">let</code> <code class="vc">fixedIncrement</code> = <code class="m">3</code></code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">You can use an instance of <code class="code-voice">ThreeSource</code> as the data source for a new <code class="code-voice">Counter</code> instance:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">var</code> <code class="vc">counter</code> = <code class="vc">Counter</code>()</code></li>
          <li><code class="code-voice"><code class="vc">counter</code>.<code class="vc">dataSource</code> = <code class="vc">ThreeSource</code>()</code></li>
          <li><code class="code-voice"><code class="kt">for</code> <code class="kt">_</code> <code class="kt">in</code> <code class="m">1</code>...<code class="m">4</code> {</code></li>
          <li><code class="code-voice">    <code class="vc">counter</code>.<code class="vc">increment</code>()</code></li>
          <li><code class="code-voice">    <code class="vc">println</code>(<code class="vc">counter</code>.<code class="vc">count</code>)</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="c">// 3</code></code></li>
          <li><code class="code-voice"><code class="c">// 6</code></code></li>
          <li><code class="code-voice"><code class="c">// 9</code></code></li>
          <li><code class="code-voice"><code class="c">// 12</code></code></li>
      </ul>



  </div>
</section><p class="para">The code above creates a new <code class="code-voice">Counter</code> instance; sets its data source to be a new <code class="code-voice">ThreeSource</code> instance; and calls the counter’s <code class="code-voice">increment</code> method four times. As expected, the counter’s <code class="code-voice">count</code> property increases by three each time <code class="code-voice">increment</code> is called.</p><p class="para">Here’s a more complex data source called <code class="code-voice">TowardsZeroSource</code>, which makes a <code class="code-voice">Counter</code> instance count up or down towards zero from its current <code class="code-voice">count</code> value:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="kt">class</code> <code class="vc">TowardsZeroSource</code>: <code class="n"><!-- a href="" logicalPath="" -->CounterDataSource<!-- /a --></code> {</code></li>
          <li><code class="code-voice">    <code class="kt">func</code> <code class="vc">incrementForCount</code>(<code class="vc">count</code>: <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code>) -&gt; <code class="n"><!-- a href="" logicalPath="" -->Int<!-- /a --></code> {</code></li>
          <li><code class="code-voice">        <code class="kt">if</code> <code class="vc">count</code> == <code class="m">0</code> {</code></li>
          <li><code class="code-voice">            <code class="kt">return</code> <code class="m">0</code></code></li>
          <li><code class="code-voice">        } <code class="kt">else</code> <code class="kt">if</code> <code class="vc">count</code> &lt; <code class="m">0</code> {</code></li>
          <li><code class="code-voice">            <code class="kt">return</code> <code class="m">1</code></code></li>
          <li><code class="code-voice">        } <code class="kt">else</code> {</code></li>
          <li><code class="code-voice">            <code class="kt">return</code> -<code class="m">1</code></code></li>
          <li><code class="code-voice">        }</code></li>
          <li><code class="code-voice">    }</code></li>
          <li><code class="code-voice">}</code></li>
      </ul>



  </div>
</section><p class="para">The <code class="code-voice">TowardsZeroSource</code> class implements the optional <code class="code-voice">incrementForCount</code> method from the <code class="code-voice">CounterDataSource</code> protocol and uses the <code class="code-voice">count</code> argument value to work out which direction to count in. If <code class="code-voice">count</code> is already zero, the method returns <code class="code-voice">0</code> to indicate that no further counting should take place.</p><p class="para">You can use an instance of <code class="code-voice">TowardsZeroSource</code> with the existing <code class="code-voice">Counter</code> instance to count from <code class="code-voice">-4</code> to zero. Once the counter reaches zero, no more counting takes place:</p><section class="code-listing">
  
  <span class="caption"></span>
  <div class="code-sample">

      <ul class="code-lines">
          <li><code class="code-voice"><code class="vc">counter</code>.<code class="vc">count</code> = -<code class="m">4</code></code></li>
          <li><code class="code-voice"><code class="vc">counter</code>.<code class="vc">dataSource</code> = <code class="vc">TowardsZeroSource</code>()</code></li>
          <li><code class="code-voice"><code class="kt">for</code> <code class="kt">_</code> <code class="kt">in</code> <code class="m">1</code>...<code class="m">5</code> {</code></li>
          <li><code class="code-voice">    <code class="vc">counter</code>.<code class="vc">increment</code>()</code></li>
          <li><code class="code-voice">    <code class="vc">println</code>(<code class="vc">counter</code>.<code class="vc">count</code>)</code></li>
          <li><code class="code-voice">}</code></li>
          <li><code class="code-voice"><code class="c">// -3</code></code></li>
          <li><code class="code-voice"><code class="c">// -2</code></code></li>
          <li><code class="code-voice"><code class="c">// -1</code></code></li>
          <li><code class="code-voice"><code class="c">// 0</code></code></li>
          <li><code class="code-voice"><code class="c">// 0</code></code></li>
      </ul>



  </div>
</section>
  
</section>

  </article>
</div>
    </div>
  </body>
</html>
